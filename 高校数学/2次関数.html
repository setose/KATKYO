<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2æ¬¡é–¢æ•°ã®åŸºç¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Roboto+Mono:wght@500&display=swap');
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        .math-font {
            font-family: 'Roboto Mono', monospace;
            font-feature-settings: "cv01";
        }
        .card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        canvas {
            background-color: #fff;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
        }
        input[type=range] {
            accent-color: #0f766e;
        }
        /* å…¥åŠ›æ¬„ */
        .calc-input {
            border: 1px solid #94a3b8;
            border-radius: 6px;
            padding: 4px 8px;
            width: 70px;
            text-align: center;
            font-family: 'Roboto Mono', monospace;
            font-weight: 500;
            outline: none;
            transition: all 0.2s;
        }
        .calc-input:focus {
            border-color: #0f766e;
            box-shadow: 0 0 0 2px rgba(15, 118, 110, 0.1);
        }
        .correct {
            border-color: #16a34a !important;
            background-color: #f0fdf4 !important;
            color: #15803d;
        }
        .wrong {
            border-color: #ef4444 !important;
            background-color: #fef2f2 !important;
        }
        .section-header {
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 1.5rem;
            background-color: #f8fafc;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        .section-title {
            font-weight: 700;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .step-number {
            background-color: #0f766e;
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Roboto Mono', monospace;
        }
    </style>
</head>
<body class="pb-20 text-slate-700">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-20">
        <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
            <div>
                <h1 class="text-lg font-bold text-slate-800">æ•°å­¦Iï¼š2æ¬¡é–¢æ•°</h1>
                <p class="text-xs text-slate-500">åŸºç¤ãƒ»ã‚°ãƒ©ãƒ•ãƒ»è¨ˆç®—</p>
            </div>
            <div class="text-slate-400 text-sm font-medium">å…¥é–€ç·¨</div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 space-y-6">

        <!-- 1. å®šç¾© -->
        <section class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="step-number">01</span>
                    2æ¬¡é–¢æ•°ã®å®šç¾©
                </h2>
            </div>
            <div class="p-6">
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="flex-1 space-y-4">
                        <p>
                            1æ¬¡é–¢æ•°ï¼ˆ<span class="math-font text-sm bg-slate-100 px-1 rounded">y = ax + b</span>ï¼‰ãŒç›´ç·šã‚’è¡¨ã™ã®ã«å¯¾ã—ã€2æ¬¡é–¢æ•°ã¯æ›²ç·šã‚’è¡¨ã—ã¾ã™ã€‚
                            ç‰©ã‚’æŠ•ã’ãŸæ™‚ã®è»Œé“ã®ã‚ˆã†ãªã“ã®æ›²ç·šã‚’<strong>æ”¾ç‰©ç·šï¼ˆã»ã†ã¶ã¤ã›ã‚“ï¼‰</strong>ã¨å‘¼ã³ã¾ã™ã€‚
                        </p>
                        <div class="bg-emerald-50 border border-emerald-100 p-4 rounded-lg">
                            <p class="text-sm font-bold text-emerald-800 mb-2">åŸºæœ¬å½¢</p>
                            <div class="text-center py-2">
                                <span class="text-3xl font-bold math-font text-slate-800">y = axÂ²</span>
                            </div>
                            <p class="text-xs text-slate-600 mt-2">
                                å³è¾ºã« <span class="math-font font-bold">xÂ²</span>ï¼ˆxã®2æ¬¡å¼ï¼‰ãŒå«ã¾ã‚Œã‚‹ã®ãŒç‰¹å¾´ã§ã™ã€‚
                            </p>
                        </div>
                    </div>
                    <div class="md:w-1/3 flex flex-col gap-3 text-sm text-slate-600">
                        <div class="bg-slate-50 p-3 rounded border border-slate-100 flex items-center gap-3">
                            <span class="text-xl">âš¾ï¸</span>
                            <span>ãƒœãƒ¼ãƒ«ã®è»Œé“</span>
                        </div>
                        <div class="bg-slate-50 p-3 rounded border border-slate-100 flex items-center gap-3">
                            <span class="text-xl">ğŸŒ‰</span>
                            <span>åŠã‚Šæ©‹ã®ã‚±ãƒ¼ãƒ–ãƒ«</span>
                        </div>
                        <div class="bg-slate-50 p-3 rounded border border-slate-100 flex items-center gap-3">
                            <span class="text-xl">ğŸ“¡</span>
                            <span>ãƒ‘ãƒ©ãƒœãƒ©ã‚¢ãƒ³ãƒ†ãƒŠ</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. ã‚°ãƒ©ãƒ•ã®æ€§è³ª -->
        <section class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="step-number">02</span>
                    ä¿‚æ•° a ã¨ã‚°ãƒ©ãƒ•ã®å½¢çŠ¶
                </h2>
            </div>
            <div class="p-6">
                <p class="mb-6 text-sm">
                    <span class="math-font font-bold">y = axÂ²</span> ã«ãŠã‘ã‚‹ä¿‚æ•° <span class="math-font">a</span> ã®å€¤ã«ã‚ˆã£ã¦ã€ã‚°ãƒ©ãƒ•ã®å½¢çŠ¶ï¼ˆé–‹ãæ–¹ã‚„å‘ãï¼‰ãŒå¤‰åŒ–ã—ã¾ã™ã€‚
                    ä¸‹ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’æ“ä½œã—ã¦ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
                </p>
                
                <div class="flex flex-col md:flex-row gap-8 items-start">
                    <!-- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ -->
                    <div class="flex flex-col items-center space-y-4 bg-slate-50 p-4 rounded-lg border border-slate-200 mx-auto md:mx-0">
                        <canvas id="graphCanvas" width="300" height="300" class="w-[280px] h-[280px] md:w-[300px] md:h-[300px]"></canvas>
                        
                        <div class="w-full max-w-[280px] space-y-2">
                            <div class="flex justify-between items-center text-sm">
                                <span class="font-bold text-slate-600">a ã®å€¤</span>
                                <span id="displayA" class="math-font text-lg font-bold text-teal-700">1.0</span>
                            </div>
                            <input type="range" id="aValue" min="-4" max="4" step="0.5" value="1" class="w-full h-1.5 bg-slate-300 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>

                    <!-- è§£èª¬ -->
                    <div class="flex-1 space-y-4 text-sm">
                        <div class="border-l-4 border-emerald-500 pl-4 py-1">
                            <h3 class="font-bold text-slate-800 mb-1">a > 0 ã®ã¨ã</h3>
                            <p class="text-slate-600">ã‚°ãƒ©ãƒ•ã¯<strong>ä¸‹ã«å‡¸ï¼ˆã¨ã¤ï¼‰</strong>ã®å½¢ã«ãªã‚Šã¾ã™ã€‚ï¼ˆè°·ã®ã‚ˆã†ãªå½¢çŠ¶ï¼‰</p>
                        </div>
                        <div class="border-l-4 border-blue-500 pl-4 py-1">
                            <h3 class="font-bold text-slate-800 mb-1">a < 0 ã®ã¨ã</h3>
                            <p class="text-slate-600">ã‚°ãƒ©ãƒ•ã¯<strong>ä¸Šã«å‡¸ï¼ˆã¨ã¤ï¼‰</strong>ã®å½¢ã«ãªã‚Šã¾ã™ã€‚ï¼ˆå±±ã®ã‚ˆã†ãªå½¢çŠ¶ï¼‰</p>
                        </div>
                        <div class="bg-slate-100 p-3 rounded text-slate-600 text-xs leading-relaxed">
                            <span class="font-bold block mb-1">çµ¶å¯¾å€¤ |a| ã®æ„å‘³</span>
                            a ã®æ•°å­—éƒ¨åˆ†ï¼ˆçµ¶å¯¾å€¤ï¼‰ãŒå¤§ãã„ã»ã©ã€ã‚°ãƒ©ãƒ•ã®é–‹ãå…·åˆã¯ç‹­ãï¼ˆæ€¥ã«ï¼‰ãªã‚Šã¾ã™ã€‚<br>
                            é€†ã«0ã«è¿‘ã„ã»ã©ã€é–‹ãå…·åˆã¯åºƒãï¼ˆç·©ã‚„ã‹ã«ï¼‰ãªã‚Šã¾ã™ã€‚
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. è¨ˆç®—æ¼”ç¿’ -->
        <section class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="step-number">03</span>
                    å€¤ã®è¨ˆç®—
                </h2>
            </div>
            <div class="p-6">
                <p class="mb-4 text-sm">
                    é–¢æ•°ã«ãŠã‘ã‚‹è¨ˆç®—ã®åŸºæœ¬ã¯ã€Œä»£å…¥ã€ã§ã™ã€‚<br>
                    <span class="font-bold">ã€Œ2ä¹—ã—ã¦ã‹ã‚‰ä¿‚æ•° a ã‚’ã‹ã‘ã‚‹ã€</span>ã¨ã„ã†é †åºã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
                </p>

                <!-- ä¾‹é¡Œ -->
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="bg-slate-600 text-white text-[10px] px-2 py-0.5 rounded font-bold">ä¾‹é¡Œ</span>
                        <span class="text-sm font-bold text-slate-700"><span class="math-font">y = 2xÂ²</span> ã«ãŠã‘ã‚‹ <span class="math-font">x = 3</span> ã®å€¤</span>
                    </div>
                    <div class="pl-4 border-l-2 border-slate-300 space-y-1 text-sm math-font text-slate-600">
                        <p>y = 2 Ã— <span class="text-red-600 font-bold">3Â²</span></p>
                        <p>y = 2 Ã— <span class="text-red-600 font-bold">9</span> <span class="text-xs font-sans text-slate-400 ml-2">â€» ç´¯ä¹—ã‚’å„ªå…ˆ</span></p>
                        <p>y = <span class="text-slate-900 font-bold">18</span></p>
                    </div>
                </div>

                <!-- æ¼”ç¿’å•é¡Œ -->
                <div>
                    <h3 class="text-sm font-bold text-slate-800 mb-3 border-b border-slate-100 pb-2">æ¼”ç¿’å•é¡Œ</h3>
                    <div class="bg-white border border-slate-200 p-5 rounded-lg shadow-sm">
                        <p class="mb-4 text-sm font-medium">
                            é–¢æ•° <span class="math-font text-lg text-teal-700">y = 3xÂ²</span> ã«ã¤ã„ã¦ã€æ¬¡ã®å€¤ã‚’æ±‚ã‚ãªã•ã„ã€‚
                        </p>
                        
                        <div class="space-y-4">
                            <div class="flex flex-wrap items-center gap-3 text-sm">
                                <span class="w-6 font-bold text-slate-400">(1)</span>
                                <span class="math-font">x = 2</span> ã®ã¨ã
                                <span class="text-slate-300 mx-2">|</span>
                                <span class="math-font text-slate-500">y = 3 Ã— 2Â² =</span>
                                <input type="number" id="q1" class="calc-input" placeholder="">
                                <span id="res1" class="text-lg"></span>
                            </div>
                            
                            <div class="flex flex-wrap items-center gap-3 text-sm">
                                <span class="w-6 font-bold text-slate-400">(2)</span>
                                <span class="math-font">x = -3</span> ã®ã¨ã
                                <span class="text-slate-300 mx-2">|</span>
                                <span class="math-font text-slate-500">y = 3 Ã— (-3)Â² =</span>
                                <input type="number" id="q2" class="calc-input" placeholder="">
                                <span id="res2" class="text-lg"></span>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex items-center justify-between">
                            <span class="text-xs text-slate-500">â€» è² ã®æ•°ã®2ä¹—ã¯æ­£ã®æ•°ã«ãªã‚Šã¾ã™ã€‚<br>(-3)Â² = (-3) Ã— (-3) = 9</span>
                            <button onclick="checkCalc()" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-6 rounded text-sm transition shadow-sm">
                                ç­”ãˆåˆã‚ã›
                            </button>
                        </div>
                        <p id="calcFeedback" class="mt-3 text-sm font-bold text-right h-5"></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. ã‚°ãƒ©ãƒ•ã®æç”» -->
        <section class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="step-number">04</span>
                    ã‚°ãƒ©ãƒ•ã®æç”»
                </h2>
            </div>
            <div class="p-6">
                <p class="mb-4 text-sm">
                    ã‚°ãƒ©ãƒ•ã‚’æãåŸºæœ¬æ‰‹é †ã¯ã€<strong>ã€Œå¤‰åŸŸå†…ã®ç‚¹ã®åº§æ¨™ã‚’æ±‚ã‚ã€ãã‚Œã‚’æ»‘ã‚‰ã‹ãªæ›²ç·šã§çµã¶ã€</strong>ã“ã¨ã§ã™ã€‚
                    ä»¥ä¸‹ã®è¡¨ã‚’åŸ‹ã‚ã¦ã€<span class="math-font">y = xÂ²</span> ã®ã‚°ãƒ©ãƒ•ã‚’å®Œæˆã•ã›ã¦ãã ã•ã„ã€‚
                </p>

                <div class="bg-slate-50 p-6 rounded-lg border border-slate-200 mb-4">
                    <div class="flex flex-col lg:flex-row gap-8 items-center justify-center">
                        <!-- ãƒ†ãƒ¼ãƒ–ãƒ« -->
                        <div class="overflow-x-auto w-full lg:w-auto">
                            <table class="text-center text-sm border-collapse bg-white shadow-sm rounded-lg overflow-hidden">
                                <thead class="bg-slate-100 text-slate-700 border-b border-slate-200">
                                    <tr>
                                        <th class="px-4 py-2 font-bold math-font border-r border-slate-200">x</th>
                                        <th class="px-4 py-2 font-bold math-font">y = xÂ²</th>
                                    </tr>
                                </thead>
                                <tbody id="plotTableBody">
                                    <!-- JSã§ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>

                        <!-- æç”»ã‚¨ãƒªã‚¢: ã‚µã‚¤ã‚ºã‚’å¤§ãã -->
                        <div class="flex flex-col items-center">
                            <canvas id="plotCanvas" width="340" height="380" class="bg-white shadow-sm border border-slate-200"></canvas>
                            <!-- ã‚°ãƒ©ãƒ•ã®ä¸‹ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º -->
                            <div id="completeMsg" class="mt-4 px-4 py-2 bg-teal-50 text-teal-700 font-bold text-sm rounded-full border border-teal-100 hidden animate-bounce">
                                ğŸ‰ ã‚°ãƒ©ãƒ•å®Œæˆï¼ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-xs text-slate-500 bg-white border border-slate-200 p-3 rounded">
                    <strong>å¯¾ç§°æ€§ï¼ˆç·šå¯¾ç§°ï¼‰ã«ã¤ã„ã¦</strong><br>
                    <span class="math-font">y = axÂ²</span> ã®ã‚°ãƒ©ãƒ•ã¯ã€yè»¸ï¼ˆ<span class="math-font">x=0</span>ã®ç·šï¼‰ã«å¯¾ã—ã¦å·¦å³å¯¾ç§°ã«ãªã‚Šã¾ã™ã€‚
                    <span class="math-font">x = 2</span> ã®ã¨ãã¨ <span class="math-font">x = -2</span> ã®ã¨ãã§ã€yã®å€¤ãŒç­‰ã—ããªã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
                </div>
            </div>
        </section>

        <!-- 5. å¼ã®æ±ºå®š -->
        <section class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="step-number">05</span>
                    2æ¬¡é–¢æ•°ã®æ±ºå®š
                </h2>
            </div>
            <div class="p-6">
                <p class="mb-4 text-sm">
                    é€šã‚‹ç‚¹ã®åº§æ¨™ãŒåˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆã€ãã‚Œã‚’å¼ã«ä»£å…¥ã™ã‚‹ã“ã¨ã§ä¿‚æ•° <span class="math-font">a</span> ã‚’æ±‚ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
                </p>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- ä¾‹é¡Œ -->
                    <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="bg-slate-600 text-white text-[10px] px-2 py-0.5 rounded font-bold">ä¾‹é¡Œ</span>
                            <span class="text-sm font-bold text-slate-700">ç‚¹ <span class="math-font">(2, 12)</span> ã‚’é€šã‚‹å ´åˆ</span>
                        </div>
                        <div class="space-y-2 text-sm text-slate-600 leading-relaxed">
                            <p>â‘  <span class="math-font">y = axÂ²</span> ã« <span class="math-font">x=2, y=12</span> ã‚’ä»£å…¥</p>
                            <p class="pl-4 math-font text-slate-800 font-medium">12 = a Ã— 2Â²</p>
                            <p>â‘¡ æ–¹ç¨‹å¼ã‚’è§£ã</p>
                            <p class="pl-4 math-font">12 = 4a</p>
                            <p class="pl-4 math-font">a = 3</p>
                            <p>â‘¢ ç­”ãˆ</p>
                            <p class="pl-4 math-font font-bold text-teal-700">y = 3xÂ²</p>
                        </div>
                    </div>

                    <!-- ç·´ç¿’ -->
                    <div class="bg-white border border-slate-200 rounded-lg p-4 shadow-sm flex flex-col justify-between">
                        <div>
                            <h3 class="text-sm font-bold text-slate-800 mb-2">ç¢ºèªå•é¡Œ</h3>
                            <p class="text-sm mb-4 text-slate-600">
                                ã‚°ãƒ©ãƒ•ãŒç‚¹ <span class="math-font text-slate-800 font-medium">(3, 18)</span> ã‚’é€šã‚‹ã¨ãã€ã“ã®2æ¬¡é–¢æ•°ã®å¼ã‚’æ±‚ã‚ãªã•ã„ã€‚
                            </p>
                        </div>
                        
                        <div>
                            <button onclick="toggleAnswer('ansFinal')" class="text-xs text-teal-600 hover:text-teal-800 font-bold underline transition">
                                è§£ç­”ãƒ»è§£èª¬ã‚’è¡¨ç¤º
                            </button>

                            <div id="ansFinal" class="hidden mt-3 pt-3 border-t border-slate-100 text-sm animate-fade-in">
                                <p class="math-font text-base font-bold text-teal-700 mb-2">y = 2xÂ²</p>
                                <div class="text-xs text-slate-500 space-y-1">
                                    <p>1. ä»£å…¥ï¼š<span class="math-font">18 = a Ã— 3Â²</span></p>
                                    <p>2. æ•´ç†ï¼š<span class="math-font">18 = 9a</span></p>
                                    <p>3. è§£ãï¼š<span class="math-font">a = 2</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        /* --- å…±é€š: ã‚°ãƒ©ãƒ•æç”»ã‚¯ãƒ©ã‚¹ --- */
        class GraphDrawer {
            // originYRatio: ã‚­ãƒ£ãƒ³ãƒã‚¹é«˜ã•ã«å¯¾ã™ã‚‹åŸç‚¹ã®Yä½ç½®ï¼ˆ0.5=ä¸­å¿ƒ, >0.5=ä¸‹å¯„ã‚Šï¼‰
            constructor(canvasId, scale = 20, originYRatio = 0.5) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.scale = scale;
                this.cx = this.canvas.width / 2;
                this.cy = this.canvas.height * originYRatio;
                this.init();
            }

            init() {
                this.clear();
                this.drawGrid();
                this.drawAxes();
            }

            clear() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            }

            drawGrid() {
                this.ctx.strokeStyle = '#f1f5f9'; // slate-100
                this.ctx.lineWidth = 1;
                this.ctx.beginPath();
                
                const w = this.canvas.width;
                const h = this.canvas.height;
                
                // ã‚°ãƒªãƒƒãƒ‰ã‚’åŸç‚¹åŸºæº–ã§æç”»
                for(let x = this.cx; x < w; x += this.scale) { this.ctx.moveTo(x, 0); this.ctx.lineTo(x, h); }
                for(let x = this.cx; x > 0; x -= this.scale) { this.ctx.moveTo(x, 0); this.ctx.lineTo(x, h); }
                
                for(let y = this.cy; y < h; y += this.scale) { this.ctx.moveTo(0, y); this.ctx.lineTo(w, y); }
                for(let y = this.cy; y > 0; y -= this.scale) { this.ctx.moveTo(0, y); this.ctx.lineTo(w, y); }
                
                this.ctx.stroke();
            }

            drawAxes() {
                const w = this.canvas.width;
                const h = this.canvas.height;

                // è»¸ç·š
                this.ctx.strokeStyle = '#94a3b8'; // slate-400
                this.ctx.lineWidth = 1.5;
                this.ctx.beginPath();
                this.ctx.moveTo(0, this.cy); this.ctx.lineTo(w, this.cy); // Xè»¸
                this.ctx.moveTo(this.cx, 0); this.ctx.lineTo(this.cx, h); // Yè»¸
                this.ctx.stroke();

                // ç›®ç››ã‚Šã¨æ•°å€¤
                this.ctx.fillStyle = '#64748b';
                this.ctx.font = '11px Roboto Mono';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'top';

                // Xè»¸
                for (let i = 1; i * this.scale < w/2 + this.scale; i++) {
                    // æ­£æ–¹å‘
                    let px = this.cx + i * this.scale;
                    if (px < w) {
                        this.ctx.beginPath(); this.ctx.moveTo(px, this.cy - 3); this.ctx.lineTo(px, this.cy + 3); this.ctx.stroke();
                        // æ··é›‘å›é¿ã®ãŸã‚ä¸€éƒ¨é–“å¼•ããƒ­ã‚¸ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã“ã¨ã‚‚å¯èƒ½ã ãŒã€ä»Šå›ã¯ã™ã¹ã¦è¡¨ç¤º
                        if (i <= 5 || i % 2 === 0) { 
                            this.ctx.fillText(i, px, this.cy + 6);
                        }
                    }
                    // è² æ–¹å‘
                    let nx = this.cx - i * this.scale;
                    if (nx > 0) {
                        this.ctx.beginPath(); this.ctx.moveTo(nx, this.cy - 3); this.ctx.lineTo(nx, this.cy + 3); this.ctx.stroke();
                        if (i <= 5 || i % 2 === 0) {
                            this.ctx.fillText(-i, nx, this.cy + 6);
                        }
                    }
                }

                // Yè»¸
                this.ctx.textAlign = 'right';
                this.ctx.textBaseline = 'middle';
                
                // ä¸Šæ–¹å‘ï¼ˆå€¤ã¯ãƒ—ãƒ©ã‚¹ï¼‰
                for (let i = 1; i * this.scale < this.cy + this.scale; i++) {
                    let py = this.cy - i * this.scale;
                    if (py > 0) {
                        this.ctx.beginPath(); this.ctx.moveTo(this.cx - 3, py); this.ctx.lineTo(this.cx + 3, py); this.ctx.stroke();
                        this.ctx.fillText(i, this.cx - 6, py);
                    }
                }
                // ä¸‹æ–¹å‘ï¼ˆå€¤ã¯ãƒã‚¤ãƒŠã‚¹ï¼‰
                for (let i = 1; i * this.scale < (h - this.cy) + this.scale; i++) {
                    let ny = this.cy + i * this.scale;
                    if (ny < h) {
                        this.ctx.beginPath(); this.ctx.moveTo(this.cx - 3, ny); this.ctx.lineTo(this.cx + 3, ny); this.ctx.stroke();
                        this.ctx.fillText(-i, this.cx - 6, ny);
                    }
                }
                
                // åŸç‚¹O
                this.ctx.fillText('O', this.cx - 6, this.cy + 6);
                
                // è»¸ãƒ©ãƒ™ãƒ«
                this.ctx.font = '12px Roboto Mono';
                this.ctx.fillStyle = '#475569';
                this.ctx.fillText('x', w - 10, this.cy - 12);
                this.ctx.textAlign = 'left';
                this.ctx.fillText('y', this.cx + 10, 15);
            }

            drawPoint(x, y, color = '#0f766e') {
                const px = this.cx + x * this.scale;
                const py = this.cy - y * this.scale;
                
                this.ctx.fillStyle = color;
                this.ctx.beginPath();
                this.ctx.arc(px, py, 5, 0, Math.PI * 2); // åŠå¾„ã‚’ 3.5 -> 5 ã«æ‹¡å¤§
                this.ctx.fill();
            }

            drawQuadratic(a, color = '#0f766e') {
                this.ctx.strokeStyle = color;
                this.ctx.lineWidth = 2.5;
                this.ctx.beginPath();
                let started = false;
                
                const step = 0.2; // æ»‘ã‚‰ã‹ã•
                for (let px = 0; px <= this.canvas.width; px += step) {
                    const x = (px - this.cx) / this.scale;
                    const y = a * x * x;
                    const py = this.cy - y * this.scale;

                    if (py >= -100 && py <= this.canvas.height + 100) {
                        if (!started) { this.ctx.moveTo(px, py); started = true; }
                        else { this.ctx.lineTo(px, py); }
                    }
                }
                this.ctx.stroke();
            }
        }

        /* --- STEP 2: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ --- */
        const simDrawer = new GraphDrawer('graphCanvas', 20, 0.5); // åŸç‚¹ã¯ä¸­å¿ƒ
        const aInput = document.getElementById('aValue');
        const displayA = document.getElementById('displayA');

        function updateSim() {
            const a = parseFloat(aInput.value);
            displayA.textContent = a.toFixed(1);
            simDrawer.init();
            const color = a >= 0 ? '#ef4444' : '#3b82f6';
            simDrawer.drawQuadratic(a, color);
        }
        aInput.addEventListener('input', updateSim);
        updateSim();

        /* --- STEP 3: è¨ˆç®—æ¼”ç¿’ --- */
        function checkCalc() {
            const q1 = parseInt(document.getElementById('q1').value);
            const q2 = parseInt(document.getElementById('q2').value);
            const res1 = document.getElementById('res1');
            const res2 = document.getElementById('res2');
            const feedback = document.getElementById('calcFeedback');
            
            let correctCount = 0;

            if (q1 === 12) {
                document.getElementById('q1').classList.add('correct');
                document.getElementById('q1').classList.remove('wrong');
                res1.innerHTML = '<span class="text-emerald-600">âœ“</span>';
                correctCount++;
            } else {
                if(!isNaN(q1)) {
                    document.getElementById('q1').classList.add('wrong');
                    document.getElementById('q1').classList.remove('correct');
                }
                res1.innerHTML = '';
            }

            if (q2 === 27) {
                document.getElementById('q2').classList.add('correct');
                document.getElementById('q2').classList.remove('wrong');
                res2.innerHTML = '<span class="text-emerald-600">âœ“</span>';
                correctCount++;
            } else {
                if(!isNaN(q2)) {
                    document.getElementById('q2').classList.add('wrong');
                    document.getElementById('q2').classList.remove('correct');
                }
                res2.innerHTML = '';
            }

            if (correctCount === 2) {
                feedback.textContent = "æ­£è§£ã§ã™ã€‚æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚";
                feedback.className = "mt-3 text-sm font-bold text-right h-5 text-emerald-600";
            } else {
                feedback.textContent = "è¨ˆç®—çµæœã‚’å†ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
                feedback.className = "mt-3 text-sm font-bold text-right h-5 text-slate-500";
            }
        }

        /* --- STEP 4: ã‚°ãƒ©ãƒ•æç”»æ¼”ç¿’ --- */
        // åŸç‚¹ã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ä¸‹ã®æ–¹(85%ã®ä½ç½®)ã«é…ç½®ã—ã¦ã€æ­£ã®å€¤ã‚’åºƒãè¡¨ç¤º
        // ã‚¹ã‚±ãƒ¼ãƒ«ã‚‚32ã«æ‹¡å¤§ã—ã¦è¦‹ã‚„ã™ã
        const plotDrawer = new GraphDrawer('plotCanvas', 32, 0.85);
        plotDrawer.init();

        const plotData = [
            { x: -3, y: 9 },
            { x: -2, y: 4 },
            { x: -1, y: 1 },
            { x: 0, y: 0, prefilled: true },
            { x: 1, y: 1 },
            { x: 2, y: 4 },
            { x: 3, y: 9 }
        ];

        const tableBody = document.getElementById('plotTableBody');
        let solvedCount = 0;

        plotData.forEach((data, index) => {
            const tr = document.createElement('tr');
            tr.className = "border-b border-slate-100 hover:bg-slate-50";
            
            const tdX = document.createElement('td');
            tdX.className = "p-2 font-medium math-font text-slate-600 border-r border-slate-100";
            tdX.textContent = data.x;
            
            const tdY = document.createElement('td');
            tdY.className = "p-2";
            
            if (data.prefilled) {
                tdY.innerHTML = `<span class="font-bold math-font text-slate-400">${data.y}</span>`;
                solvedCount++;
                plotDrawer.drawPoint(data.x, data.y, '#94a3b8');
            } else {
                const input = document.createElement('input');
                input.type = "number";
                input.className = "calc-input w-12 text-sm";
                input.dataset.index = index;
                
                input.addEventListener('input', (e) => {
                    const val = parseInt(e.target.value);
                    if (val === data.y) {
                        if (!e.target.classList.contains('correct')) {
                            e.target.classList.add('correct');
                            e.target.disabled = true;
                            plotDrawer.drawPoint(data.x, data.y);
                            solvedCount++;
                            checkAllSolved();
                        }
                    }
                });
                tdY.appendChild(input);
            }

            tr.appendChild(tdX);
            tr.appendChild(tdY);
            tableBody.appendChild(tr);
        });

        function checkAllSolved() {
            if (solvedCount === plotData.length) {
                setTimeout(() => {
                    plotDrawer.drawQuadratic(1, '#0f766e');
                    document.getElementById('completeMsg').classList.remove('hidden');
                }, 500);
            }
        }

        function toggleAnswer(id) {
            const el = document.getElementById(id);
            if (el.classList.contains('hidden')) {
                el.classList.remove('hidden');
            } else {
                el.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
