<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2æ¬¡é–¢æ•°ã®å¹³è¡Œç§»å‹•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Roboto+Mono:wght@500&display=swap');
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        .math-font {
            font-family: 'Roboto Mono', monospace;
            font-feature-settings: "cv01";
        }
        .card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        canvas {
            background-color: #fff;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
        }
        input[type=range] {
            accent-color: #0f766e;
        }
        /* å…¥åŠ›æ¬„ */
        .calc-input {
            border: 1px solid #94a3b8;
            border-radius: 6px;
            padding: 4px 8px;
            width: 70px;
            text-align: center;
            font-family: 'Roboto Mono', monospace;
            font-weight: 500;
            outline: none;
            transition: all 0.2s;
        }
        .calc-input:focus {
            border-color: #0f766e;
            box-shadow: 0 0 0 2px rgba(15, 118, 110, 0.1);
        }
        .correct {
            border-color: #16a34a !important;
            background-color: #f0fdf4 !important;
            color: #15803d;
        }
        .wrong {
            border-color: #ef4444 !important;
            background-color: #fef2f2 !important;
        }
        .section-header {
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 1.5rem;
            background-color: #f8fafc;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        .section-title {
            font-weight: 700;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .step-number {
            background-color: #0f766e;
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Roboto Mono', monospace;
        }
    </style>
</head>
<body class="pb-20 text-slate-700">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-20">
        <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
            <div>
                <h1 class="text-lg font-bold text-slate-800">æ•°å­¦Iï¼š2æ¬¡é–¢æ•°</h1>
                <p class="text-xs text-slate-500">å¹³è¡Œç§»å‹•ãƒ»ã‚°ãƒ©ãƒ•ã®å½¢çŠ¶ãƒ»é ‚ç‚¹</p>
            </div>
            <div class="text-slate-400 text-sm font-medium">åŸºæœ¬ç·¨</div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 space-y-6">

        <!-- 0. å°å…¥æ¯”è¼ƒ -->
        <section class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="step-number">Start</span>
                    ä»Šå›ã®ãƒ†ãƒ¼ãƒ
                </h2>
            </div>
            <div class="p-6">
                <p class="mb-6 text-sm">
                    ä»Šã¾ã§ç¿’ã£ãŸåŸºæœ¬å½¢ã¨ã€ä»Šå›æ–°ã—ãå­¦ã¶å¼ã‚’æ¯”ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br>
                    ãŠå°»ã«<strong>ã€Œæ•°å­—ï¼ˆ<span class="math-font">+q</span>ï¼‰ã€</strong>ãŒãã£ã¤ã„ã¦ã„ã‚‹ã®ãŒæœ€å¤§ã®é•ã„ã§ã™ã€‚
                </p>
                <div class="grid md:grid-cols-2 gap-6 items-center">
                    <!-- åŸºæœ¬å½¢ -->
                    <div class="bg-slate-50 p-5 rounded-xl border border-slate-200 text-center relative">
                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-slate-200 text-slate-600 text-[10px] font-bold px-2 py-0.5 rounded-full">
                            ã“ã‚Œã¾ã§ã®å¾©ç¿’
                        </div>
                        <p class="text-xs text-slate-500 mb-2 font-bold">åŸºæœ¬å½¢</p>
                        <p class="math-font text-2xl font-bold text-slate-700 mb-3">y = axÂ²</p>
                        <div class="text-xs text-slate-500 bg-white inline-block px-3 py-1 rounded border border-slate-100">
                            é ‚ç‚¹ <span class="math-font font-bold">(0, 0)</span>
                        </div>
                    </div>
                    
                    <!-- ä»Šå›ã®å½¢ -->
                    <div class="bg-emerald-50 p-5 rounded-xl border border-emerald-200 text-center relative shadow-sm">
                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-emerald-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm">
                            NEW
                        </div>
                        <p class="text-xs text-emerald-600 mb-2 font-bold">ä»Šå›ã®ä¸»å½¹</p>
                        <p class="math-font text-2xl font-bold text-emerald-800 mb-3">
                            y = axÂ² <span class="bg-emerald-200 px-1 rounded ring-2 ring-emerald-100">+ q</span>
                        </p>
                        <div class="text-xs text-emerald-700 bg-white/80 inline-block px-3 py-1 rounded border border-emerald-100">
                            é ‚ç‚¹ <span class="math-font font-bold">(0, q)</span>
                        </div>
                    </div>
                </div>
                <p class="mt-6 text-sm text-center text-slate-600 bg-slate-50 p-2 rounded">
                    ã“ã® <span class="math-font font-bold text-emerald-600">+ q</span> ãŒã€ã‚°ãƒ©ãƒ•ã‚’ä¸Šä¸‹ã«å‹•ã‹ã™éµã«ãªã‚Šã¾ã™ã€‚
                </p>
            </div>
        </section>

        <!-- 1. ç‚¹ã®ç§»å‹• -->
        <section class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="step-number">01</span>
                    ç‚¹ã®ç¸¦ç§»å‹•
                </h2>
            </div>
            <div class="p-6">
                <p class="mb-4 text-sm">
                    ã‚°ãƒ©ãƒ•å…¨ä½“ã‚’å‹•ã‹ã™å‰ã«ã€ã¾ãšã¯1ã¤ã®ã€Œç‚¹ã€ã‚’å‹•ã‹ã™ã“ã¨ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚<br>
                    ã‚ã‚‹ç‚¹ <span class="math-font">(x, y)</span> ã®yåº§æ¨™ã«æ•°ã‚’è¶³ã™ã¨ã€ç‚¹ã¯çœŸä¸Šã«ç§»å‹•ã—ã¾ã™ã€‚
                </p>

                <div class="flex flex-col md:flex-row gap-8 items-center justify-center bg-slate-50 p-6 rounded-lg border border-slate-200">
                    <!-- ç‚¹ç§»å‹•ã®ã‚°ãƒ©ãƒ• (NEW) -->
                    <div class="flex flex-col items-center gap-2">
                        <canvas id="pointMoveCanvas" width="280" height="280" class="shadow-sm bg-white"></canvas>
                        <p class="text-xs text-slate-400">ã‚°ãƒ©ãƒ•ä¸Šã®ç‚¹ã®ç§»å‹•</p>
                    </div>

                    <!-- è§£èª¬å›³ -->
                    <div class="space-y-4 max-w-sm">
                        <div class="flex items-center gap-4 bg-white p-3 rounded shadow-sm border border-slate-100">
                            <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-500">A</div>
                            <div class="text-sm">
                                <span class="block text-xs text-slate-400">å…ƒã®ç‚¹</span>
                                <span class="math-font font-bold text-lg">(2, 4)</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-2 text-slate-500 font-bold pl-2">
                            <span class="text-2xl">â†“</span>
                            <span class="text-sm bg-emerald-100 text-emerald-700 px-2 py-1 rounded">+3 å¹³è¡Œç§»å‹•</span>
                        </div>

                        <div class="flex items-center gap-4 bg-white p-3 rounded shadow-sm border border-emerald-100 ring-2 ring-emerald-50">
                            <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center font-bold text-emerald-600">A'</div>
                            <div class="text-sm">
                                <span class="block text-xs text-slate-400">ç§»å‹•å¾Œã®ç‚¹</span>
                                <span class="math-font font-bold text-lg text-emerald-700">(2, 7)</span>
                            </div>
                        </div>

                        <div class="text-sm bg-white p-4 rounded border border-slate-200 mt-4">
                            <h3 class="font-bold text-slate-700 mb-2">ãƒã‚¤ãƒ³ãƒˆ</h3>
                            <ul class="list-disc pl-5 space-y-1 text-slate-600">
                                <li>xåº§æ¨™ï¼ˆæ¨ªã®ä½ç½®ï¼‰ã¯å¤‰ã‚ã‚‰ãªã„ã€‚</li>
                                <li>yåº§æ¨™ï¼ˆé«˜ã•ï¼‰ã ã‘ãŒå¤‰ã‚ã‚‹ã€‚</li>
                                <li>ã€Œ<span class="font-bold text-emerald-600">yè»¸æ–¹å‘ã« +3 å¹³è¡Œç§»å‹•ã—ãŸ</span>ã€ã¨è¨€ã„ã¾ã™ã€‚</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. ã‚°ãƒ©ãƒ•ã®å¹³è¡Œç§»å‹•ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼‰ -->
        <section class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="step-number">02</span>
                    ã‚°ãƒ©ãƒ•ã®å¹³è¡Œç§»å‹•
                </h2>
            </div>
            <div class="p-6">
                <p class="mb-6 text-sm">
                    ã™ã¹ã¦ã®ç‚¹ã‚’åŒã˜ã ã‘ä¸Šä¸‹ã«å‹•ã‹ã™ã¨ã€ã‚°ãƒ©ãƒ•å…¨ä½“ãŒå¹³è¡Œç§»å‹•ã—ã¾ã™ã€‚<br>
                    ä¸‹ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦ã€<span class="math-font text-lg font-bold text-emerald-700">y = xÂ² + q</span> ã®ã‚°ãƒ©ãƒ•ãŒã©ã†å‹•ãã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
                </p>
                
                <div class="flex flex-col md:flex-row gap-8 items-start justify-center">
                    <!-- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ -->
                    <div class="flex flex-col items-center space-y-4 bg-slate-50 p-4 rounded-lg border border-slate-200 mx-auto md:mx-0">
                        <canvas id="graphCanvas" width="300" height="300" class="w-[280px] h-[280px] md:w-[300px] md:h-[300px]"></canvas>
                        
                        <div class="w-full max-w-[280px] space-y-3">
                            <div class="flex justify-between items-center text-sm">
                                <span class="font-bold text-slate-600">q ã®å€¤ (ä¸Šä¸‹ç§»å‹•)</span>
                                <span id="displayQ" class="math-font text-lg font-bold text-emerald-700">0</span>
                            </div>
                            <input type="range" id="qValue" min="-4" max="4" step="1" value="0" class="w-full h-1.5 bg-slate-300 rounded-lg appearance-none cursor-pointer">
                            
                            <div class="text-center bg-white p-2 rounded border border-slate-200 text-sm math-font">
                                å¼ï¼š <span class="font-bold">y = xÂ² <span id="equationPart" class="text-emerald-600"></span></span>
                            </div>
                        </div>
                    </div>

                    <!-- è§£èª¬ -->
                    <div class="flex-1 space-y-4 text-sm max-w-sm">
                        <div class="border-l-4 border-emerald-500 pl-4 py-1">
                            <h3 class="font-bold text-slate-800 mb-1">åŸºæœ¬ã®å½¢ã¨ã®æ¯”è¼ƒ</h3>
                            <p class="text-slate-600 mb-2">
                                ç‚¹ç·šã¯åŸºæœ¬ã® <span class="math-font">y = xÂ²</span> ã§ã™ã€‚
                                å®Ÿç·šãŒ <span class="math-font">y = xÂ² + q</span> ã§ã™ã€‚
                            </p>
                            <p class="text-slate-600">
                                å½¢ï¼ˆé–‹ãå…·åˆï¼‰ã¯å…¨ãå¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
                                ãã®ã¾ã¾ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã®ã‚ˆã†ã«ä¸Šä¸‹ã«å‹•ã„ã¦ã„ã¾ã™ã€‚
                            </p>
                        </div>

                        <div class="bg-amber-50 p-3 rounded text-slate-700 border border-amber-100">
                            <span class="font-bold block mb-1 text-amber-800">â˜… é ‚ç‚¹ï¼ˆã¡ã‚‡ã†ã¦ã‚“ï¼‰ã«æ³¨ç›®ï¼</span>
                            ä¸€ç•ªä¸‹ã®ç‚¹ï¼ˆé ‚ç‚¹ï¼‰ã¯ã€åŸç‚¹ <span class="math-font">(0, 0)</span> ã‹ã‚‰ <span class="math-font font-bold text-emerald-700">(0, q)</span> ã«ç§»å‹•ã—ã¦ã„ã¾ã™ã€‚<br>
                            ã“ã®é ‚ç‚¹ã®åº§æ¨™ã‚’è¦‹ã‚‹ã ã‘ã§ã€ã©ã‚Œã ã‘ç§»å‹•ã—ãŸã‹ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. ä¾‹é¡Œè§£èª¬ -->
        <section class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="step-number">03</span>
                    å¼ã¨é ‚ç‚¹ã®é–¢ä¿‚
                </h2>
            </div>
            <div class="p-6">
                <p class="mb-4 text-sm">
                    å¼ã‚’è¦‹ãŸã ã‘ã§ã€ã€Œã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ã€ã¨ã€Œã©ã†ç§»å‹•ã—ãŸã‹ã€ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
                </p>

                <!-- ä¾‹é¡Œãƒ–ãƒ­ãƒƒã‚¯ -->
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-5 mb-6">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="bg-slate-600 text-white text-[10px] px-2 py-0.5 rounded font-bold">ä¾‹é¡Œ</span>
                        <span class="text-sm font-bold text-slate-700">æ¬¡ã®2æ¬¡é–¢æ•°ã®ã‚°ãƒ©ãƒ•ã«ã¤ã„ã¦ç­”ãˆãªã•ã„ã€‚</span>
                    </div>
                    
                    <div class="text-center py-4 bg-white rounded border border-slate-100 mb-4">
                        <span class="math-font text-2xl font-bold text-slate-800">y = 2xÂ² <span class="text-emerald-600">+ 3</span></span>
                    </div>

                    <div class="space-y-4 text-sm text-slate-600">
                        <div>
                            <p class="font-bold text-slate-800 mb-1">â‘  ã©ã®ã‚ˆã†ã«ç§»å‹•ã—ãŸã‚‚ã®ï¼Ÿ</p>
                            <p class="pl-4 border-l-2 border-emerald-200">
                                <span class="math-font">y = 2xÂ²</span> ã®ã‚°ãƒ©ãƒ•ã‚’ <span class="font-bold text-emerald-700">yè»¸æ–¹å‘ã« +3</span> å¹³è¡Œç§»å‹•ã—ãŸã‚‚ã®ã€‚
                            </p>
                        </div>
                        <div>
                            <p class="font-bold text-slate-800 mb-1">â‘¡ é ‚ç‚¹ã®åº§æ¨™ã¯ï¼Ÿ</p>
                            <p class="pl-4 border-l-2 border-emerald-200">
                                å…ƒã®é ‚ç‚¹ <span class="math-font">(0, 0)</span> ã‚‚ +3 ä¸ŠãŒã‚‹ã®ã§ã€<br>
                                ç­”ãˆï¼š <span class="math-font font-bold text-emerald-700">(0, 3)</span>
                            </p>
                        </div>
                        <div>
                            <p class="font-bold text-slate-800 mb-1">â‘¢ è»¸ï¼ˆã˜ãï¼‰ã®æ–¹ç¨‹å¼ã¯ï¼Ÿ</p>
                            <p class="pl-4 border-l-2 border-emerald-200">
                                ä¸Šä¸‹ã«å‹•ã„ã¦ã‚‚ã€å·¦å³ã®çœŸã‚“ä¸­ã®ç·šï¼ˆyè»¸ï¼‰ã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
                                ç­”ãˆï¼š <span class="math-font font-bold">x = 0</span> ï¼ˆyè»¸ã®ã“ã¨ï¼‰
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. ç·´ç¿’å•é¡Œ -->
        <section class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="step-number">04</span>
                    ç·´ç¿’å•é¡Œ
                </h2>
            </div>
            <div class="p-6">
                <p class="mb-4 text-sm">
                    æ¬¡ã®å•é¡Œã‚’è§£ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å¼ã®ãŠå°»ã«ã¤ã„ã¦ã„ã‚‹æ•°å­—ï¼ˆå®šæ•°é …ï¼‰ã‚’è¦‹ã‚‹ã®ãŒã‚³ãƒ„ã§ã™ã€‚
                </p>

                <div class="bg-white border border-slate-200 p-5 rounded-lg shadow-sm space-y-8">
                    
                    <!-- å•1 -->
                    <div>
                        <div class="flex items-center gap-2 mb-3">
                            <span class="bg-emerald-600 text-white text-xs px-2 py-1 rounded font-bold">å•1</span>
                            <span class="text-sm font-bold">ã‚°ãƒ©ãƒ•ã®é ‚ç‚¹ã‚’ç­”ãˆãªã•ã„</span>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-slate-50 p-3 rounded border border-slate-100">
                                <p class="math-font text-lg text-center mb-2">y = xÂ² + 5</p>
                                <div class="flex justify-center items-center gap-2 text-sm">
                                    <span>é ‚ç‚¹ï¼š</span>
                                    <span class="math-font">( 0 , </span>
                                    <input type="number" id="q1" class="calc-input w-16">
                                    <span class="math-font"> )</span>
                                    <span id="res1" class="text-lg w-6"></span>
                                </div>
                            </div>
                            <div class="bg-slate-50 p-3 rounded border border-slate-100">
                                <p class="math-font text-lg text-center mb-2">y = 3xÂ² - 2</p>
                                <div class="flex justify-center items-center gap-2 text-sm">
                                    <span>é ‚ç‚¹ï¼š</span>
                                    <span class="math-font">( 0 , </span>
                                    <input type="number" id="q2" class="calc-input w-16">
                                    <span class="math-font"> )</span>
                                    <span id="res2" class="text-lg w-6"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å•2 -->
                    <div>
                        <div class="flex items-center gap-2 mb-3">
                            <span class="bg-emerald-600 text-white text-xs px-2 py-1 rounded font-bold">å•2</span>
                            <span class="text-sm font-bold">å¼ã®æ±ºå®š</span>
                        </div>
                        <p class="text-sm text-slate-600 mb-3">
                            <span class="math-font">y = 2xÂ²</span> ã®ã‚°ãƒ©ãƒ•ã‚’ã€yè»¸æ–¹å‘ã« <span class="font-bold">-4</span> ã ã‘å¹³è¡Œç§»å‹•ã—ãŸã‚°ãƒ©ãƒ•ã®å¼ã‚’æ›¸ããªã•ã„ã€‚
                        </p>
                        <div class="flex justify-center items-center gap-2 bg-slate-50 p-4 rounded border border-slate-100">
                            <span class="math-font font-bold text-lg">y = 2xÂ²</span>
                            <input type="text" id="q3" class="calc-input w-20" placeholder="+â–¡">
                            <span id="res3" class="text-lg w-6"></span>
                        </div>
                        <p class="text-xs text-slate-400 mt-2 text-center">â€» ç¬¦å·ï¼ˆ+ ã‚„ -ï¼‰ã‚‚å«ã‚ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                    </div>

                    <!-- åˆ¤å®šãƒœã‚¿ãƒ³ -->
                    <div class="flex flex-col items-center">
                        <button onclick="checkAnswers()" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-8 rounded text-sm transition shadow-sm w-full md:w-auto">
                            ç­”ãˆåˆã‚ã›
                        </button>
                        <p id="feedback" class="mt-3 text-sm font-bold h-5"></p>
                    </div>

                </div>
            </div>
        </section>

    </main>

    <script>
        /* --- å…±é€š: ã‚°ãƒ©ãƒ•æç”»ã‚¯ãƒ©ã‚¹ --- */
        class GraphDrawer {
            // originYRatio ã‚’è¿½åŠ ã—ã¦åŸç‚¹ã®é«˜ã•ã‚’èª¿æ•´å¯èƒ½ã«
            constructor(canvasId, scale = 20, originYRatio = 0.5) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.scale = scale;
                this.cx = this.canvas.width / 2;
                this.cy = this.canvas.height * originYRatio;
                this.init();
            }

            init() {
                this.clear();
                this.drawGrid();
                this.drawAxes();
            }

            clear() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            }

            drawGrid() {
                this.ctx.strokeStyle = '#f1f5f9';
                this.ctx.lineWidth = 1;
                this.ctx.beginPath();
                const w = this.canvas.width;
                const h = this.canvas.height;
                
                // ã‚°ãƒªãƒƒãƒ‰ã‚’åŸç‚¹åŸºæº–ã§æç”»
                for(let x = this.cx; x < w; x += this.scale) { this.ctx.moveTo(x, 0); this.ctx.lineTo(x, h); }
                for(let x = this.cx; x > 0; x -= this.scale) { this.ctx.moveTo(x, 0); this.ctx.lineTo(x, h); }
                
                for(let y = this.cy; y < h; y += this.scale) { this.ctx.moveTo(0, y); this.ctx.lineTo(w, y); }
                for(let y = this.cy; y > 0; y -= this.scale) { this.ctx.moveTo(0, y); this.ctx.lineTo(w, y); }
                
                this.ctx.stroke();
            }

            drawAxes() {
                const w = this.canvas.width;
                const h = this.canvas.height;
                this.ctx.strokeStyle = '#94a3b8';
                this.ctx.lineWidth = 1.5;
                this.ctx.beginPath();
                this.ctx.moveTo(0, this.cy); this.ctx.lineTo(w, this.cy);
                this.ctx.moveTo(this.cx, 0); this.ctx.lineTo(this.cx, h);
                this.ctx.stroke();

                this.ctx.fillStyle = '#64748b';
                this.ctx.font = '11px Roboto Mono';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'top';

                // Xè»¸ç›®ç››ã‚Šï¼ˆå‹•çš„è¨ˆç®—ï¼‰
                const xSteps = Math.floor(w / 2 / this.scale);
                for (let i = -xSteps; i <= xSteps; i++) {
                    if (i === 0) continue;
                    let px = this.cx + i * this.scale;
                    if (px > 0 && px < w) {
                        this.ctx.beginPath(); this.ctx.moveTo(px, this.cy - 3); this.ctx.lineTo(px, this.cy + 3); this.ctx.stroke();
                        // æ•°å€¤è¡¨ç¤º (é–“å¼•ã)
                        if (i % 2 === 0) this.ctx.fillText(i, px, this.cy + 6);
                    }
                }

                // Yè»¸ç›®ç››ã‚Šï¼ˆå‹•çš„è¨ˆç®—ï¼‰
                this.ctx.textAlign = 'right';
                this.ctx.textBaseline = 'middle';
                const yStepsTop = Math.floor(this.cy / this.scale);
                const yStepsBottom = Math.floor((h - this.cy) / this.scale);
                
                for (let i = -yStepsBottom; i <= yStepsTop; i++) {
                    if (i === 0) continue;
                    let py = this.cy - i * this.scale;
                    if (py > 0 && py < h) {
                        this.ctx.beginPath(); this.ctx.moveTo(this.cx - 3, py); this.ctx.lineTo(this.cx + 3, py); this.ctx.stroke();
                        // æ•°å€¤è¡¨ç¤º
                         if (Math.abs(i) % 2 === 0) this.ctx.fillText(i, this.cx - 6, py);
                    }
                }
                
                this.ctx.fillText('O', this.cx - 6, this.cy + 6);
            }

            drawPoint(x, y, label = "", color = '#64748b') {
                const px = this.cx + x * this.scale;
                const py = this.cy - y * this.scale;

                this.ctx.fillStyle = color;
                this.ctx.beginPath();
                this.ctx.arc(px, py, 4, 0, Math.PI * 2);
                this.ctx.fill();

                if (label) {
                    this.ctx.fillStyle = color;
                    this.ctx.font = 'bold 12px Roboto Mono';
                    this.ctx.textAlign = 'left';
                    this.ctx.fillText(label, px + 8, py);
                }
            }

            drawArrow(x1, y1, x2, y2, color = '#059669') {
                const px1 = this.cx + x1 * this.scale;
                const py1 = this.cy - y1 * this.scale;
                const px2 = this.cx + x2 * this.scale;
                const py2 = this.cy - y2 * this.scale;

                this.ctx.strokeStyle = color;
                this.ctx.fillStyle = color;
                this.ctx.lineWidth = 2;

                // ç‚¹ç·šã‚’æã
                this.ctx.beginPath();
                this.ctx.setLineDash([4, 4]);
                this.ctx.moveTo(px1, py1);
                this.ctx.lineTo(px2, py2);
                this.ctx.stroke();
                this.ctx.setLineDash([]);

                // çŸ¢å°ã®é ­
                const headLen = 8;
                const angle = Math.atan2(py2 - py1, px2 - px1);
                this.ctx.beginPath();
                this.ctx.moveTo(px2, py2);
                this.ctx.lineTo(px2 - headLen * Math.cos(angle - Math.PI / 6), py2 - headLen * Math.sin(angle - Math.PI / 6));
                this.ctx.lineTo(px2 - headLen * Math.cos(angle + Math.PI / 6), py2 - headLen * Math.sin(angle + Math.PI / 6));
                this.ctx.closePath();
                this.ctx.fill();
            }

            // offsetQ: yè»¸æ–¹å‘ã¸ã®å¹³è¡Œç§»å‹•é‡
            drawQuadratic(a, offsetQ, color = '#0f766e', isDashed = false) {
                this.ctx.strokeStyle = color;
                this.ctx.lineWidth = 2.5;
                if (isDashed) {
                    this.ctx.setLineDash([5, 5]);
                    this.ctx.lineWidth = 1.5;
                } else {
                    this.ctx.setLineDash([]);
                }

                this.ctx.beginPath();
                let started = false;
                const step = 0.2;
                
                for (let px = 0; px <= this.canvas.width; px += step) {
                    const x = (px - this.cx) / this.scale;
                    // y = ax^2 + q
                    const y = (a * x * x) + offsetQ;
                    const py = this.cy - y * this.scale;

                    if (py >= -100 && py <= this.canvas.height + 100) {
                        if (!started) { this.ctx.moveTo(px, py); started = true; }
                        else { this.ctx.lineTo(px, py); }
                    }
                }
                this.ctx.stroke();
                this.ctx.setLineDash([]); // ãƒªã‚»ãƒƒãƒˆ

                // é ‚ç‚¹ã®æç”»ï¼ˆå®Ÿç·šã®å ´åˆã®ã¿ï¼‰
                if (!isDashed) {
                    const vertexY = this.cy - offsetQ * this.scale;
                    this.ctx.fillStyle = color;
                    this.ctx.beginPath();
                    this.ctx.arc(this.cx, vertexY, 5, 0, Math.PI * 2);
                    this.ctx.fill();
                }
            }
        }

        /* --- 1. ç‚¹ã®ç§»å‹•ã‚°ãƒ©ãƒ•æç”» --- */
        // åŸç‚¹ã‚’ä¸‹(0.8)ã«ã—ã¦ã€ä¸Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç©ºã‘ã‚‹ (2, 7)ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚
        const pointDrawer = new GraphDrawer('pointMoveCanvas', 24, 0.85); 
        pointDrawer.init();
        
        // å…ƒã®ç‚¹ A(2, 4)
        pointDrawer.drawPoint(2, 4, "A(2, 4)", "#64748b");
        
        // ç§»å‹•å¾Œã®ç‚¹ A'(2, 7)
        pointDrawer.drawPoint(2, 7, "A'(2, 7)", "#059669");
        
        // çŸ¢å°
        pointDrawer.drawArrow(2, 4, 2, 7, "#059669");


        /* --- 2. ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ --- */
        // ã‚¹ã‚±ãƒ¼ãƒ«ã‚’16ã«ç¸®å°ã€åŸç‚¹ä½ç½®ã‚’0.7(ä¸‹å¯„ã‚Š)ã«ã—ã¦ä¸Šéƒ¨ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿
        const simDrawer = new GraphDrawer('graphCanvas', 16, 0.7);
        const qInput = document.getElementById('qValue');
        const displayQ = document.getElementById('displayQ');
        const equationPart = document.getElementById('equationPart');

        function updateSim() {
            const q = parseInt(qInput.value);
            
            // è¡¨ç¤ºã®æ›´æ–°
            displayQ.textContent = (q > 0 ? "+" + q : q);
            if (q === 0) {
                equationPart.textContent = "";
                displayQ.textContent = "0";
            } else if (q > 0) {
                equationPart.textContent = " + " + q;
            } else {
                equationPart.textContent = " - " + Math.abs(q);
            }

            simDrawer.init();
            
            // åŸºæº–ç·š (y=x^2)
            simDrawer.drawQuadratic(1, 0, '#94a3b8', true); // ã‚°ãƒ¬ãƒ¼ã€ç‚¹ç·š
            
            // ç§»å‹•å¾Œã®ç·š (y=x^2+q)
            simDrawer.drawQuadratic(1, q, '#059669', false); // ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰ã€å®Ÿç·š
        }
        qInput.addEventListener('input', updateSim);
        updateSim();

        /* --- ç·´ç¿’å•é¡Œã®ãƒã‚§ãƒƒã‚¯ --- */
        function checkAnswers() {
            const q1 = parseFloat(document.getElementById('q1').value);
            const q2 = parseFloat(document.getElementById('q2').value);
            const q3Str = document.getElementById('q3').value.replace(/\s+/g, ''); // ç©ºç™½é™¤å»
            
            const res1 = document.getElementById('res1');
            const res2 = document.getElementById('res2');
            const res3 = document.getElementById('res3');
            const feedback = document.getElementById('feedback');

            let correctCount = 0;

            // å•1-1: y = x^2 + 5 -> é ‚ç‚¹(0, 5)
            if (q1 === 5) {
                res1.innerHTML = '<span class="text-emerald-600">âœ“</span>';
                document.getElementById('q1').classList.add('correct');
                document.getElementById('q1').classList.remove('wrong');
                correctCount++;
            } else {
                res1.innerHTML = '';
                document.getElementById('q1').classList.add('wrong');
                document.getElementById('q1').classList.remove('correct');
            }

            // å•1-2: y = 3x^2 - 2 -> é ‚ç‚¹(0, -2)
            if (q2 === -2) {
                res2.innerHTML = '<span class="text-emerald-600">âœ“</span>';
                document.getElementById('q2').classList.add('correct');
                document.getElementById('q2').classList.remove('wrong');
                correctCount++;
            } else {
                res2.innerHTML = '';
                document.getElementById('q2').classList.add('wrong');
                document.getElementById('q2').classList.remove('correct');
            }

            // å•2: -4
            if (q3Str === "-4") {
                res3.innerHTML = '<span class="text-emerald-600">âœ“</span>';
                document.getElementById('q3').classList.add('correct');
                document.getElementById('q3').classList.remove('wrong');
                correctCount++;
            } else {
                res3.innerHTML = '';
                document.getElementById('q3').classList.add('wrong');
                document.getElementById('q3').classList.remove('correct');
            }

            // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            if (correctCount === 3) {
                feedback.textContent = "å…¨å•æ­£è§£ã§ã™ï¼ã“ã®èª¿å­ã§ã„ãã¾ã—ã‚‡ã†ğŸ‰";
                feedback.className = "mt-3 text-sm font-bold text-emerald-600 animate-bounce";
            } else {
                feedback.textContent = "æƒœã—ã„ï¼ç¬¦å·ï¼ˆãƒ—ãƒ©ã‚¹ãƒ»ãƒã‚¤ãƒŠã‚¹ï¼‰ã‚’ç¢ºèªã—ã¦ã¿ã‚ˆã†ã€‚";
                feedback.className = "mt-3 text-sm font-bold text-slate-500";
            }
        }
    </script>
</body>
</html>
