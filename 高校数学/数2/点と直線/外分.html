<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数II：点と直線（外分）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f0f9ff;
        }
        .math-fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
        }
        .math-fraction .top {
            border-bottom: 2px solid black;
            display: block;
            padding: 0 5px;
        }
        .math-fraction .bottom {
            display: block;
            padding: 0 5px;
        }
        /* Custom Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #bfdbfe;
            border-radius: 2px;
        }
        /* Firefox */
        input[type=range]::-moz-range-thumb {
            height: 16px;
            width: 16px;
            border: none;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type=range]::-moz-range-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #bfdbfe;
            border-radius: 2px;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 shadow-md sticky top-0 z-20">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-xl md:text-2xl font-bold">数II：点と直線</h1>
                <p class="text-blue-100 text-sm">1次元（数直線）における外分</p>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 space-y-8">

        <!-- 1. 解説セクション -->
        <section class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-4">1. 外分とは？</h2>
            
            <p class="mb-4 leading-relaxed">
                線分ABを <span class="font-bold text-indigo-600">m : n</span> に外分する点Qとは、
                線分ABの<span class="text-red-500 font-bold">外側</span>にあって、
                <span class="bg-gray-100 px-2 py-1 rounded border">AQ : QB = m : n</span>
                となる点のことです。
            </p>

            <div class="grid md:grid-cols-2 gap-6 my-6">
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <h3 class="font-bold text-center mb-2">m > n のとき</h3>
                    <p class="text-sm text-center mb-2">QはBの右側（Bの外側）にあります</p>
                    <div class="relative h-12 w-full flex items-center justify-center">
                        <div class="absolute w-full h-0.5 bg-gray-400"></div>
                        <div class="absolute w-2 h-2 bg-blue-500 rounded-full" style="left: 20%"></div>
                        <span class="absolute text-xs font-bold -bottom-4" style="left: 20%">A</span>
                        
                        <div class="absolute w-2 h-2 bg-blue-500 rounded-full" style="left: 50%"></div>
                        <span class="absolute text-xs font-bold -bottom-4" style="left: 50%">B</span>
                        
                        <div class="absolute w-3 h-3 bg-red-500 rounded-full z-10" style="left: 80%"></div>
                        <span class="absolute text-xs font-bold text-red-600 -bottom-4" style="left: 80%">Q</span>
                    </div>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <h3 class="font-bold text-center mb-2">m < n のとき</h3>
                    <p class="text-sm text-center mb-2">QはAの左側（Aの外側）にあります</p>
                    <div class="relative h-12 w-full flex items-center justify-center">
                        <div class="absolute w-full h-0.5 bg-gray-400"></div>
                        <div class="absolute w-3 h-3 bg-red-500 rounded-full z-10" style="left: 20%"></div>
                        <span class="absolute text-xs font-bold text-red-600 -bottom-4" style="left: 20%">Q</span>

                        <div class="absolute w-2 h-2 bg-blue-500 rounded-full" style="left: 50%"></div>
                        <span class="absolute text-xs font-bold -bottom-4" style="left: 50%">A</span>
                        
                        <div class="absolute w-2 h-2 bg-blue-500 rounded-full" style="left: 80%"></div>
                        <span class="absolute text-xs font-bold -bottom-4" style="left: 80%">B</span>
                    </div>
                </div>
            </div>

            <h3 class="font-bold text-lg mb-2">公式</h3>
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                <p class="mb-2">2点 <span class="font-serif italic">A(a)</span>, <span class="font-serif italic">B(b)</span> を結ぶ線分ABを <span class="font-serif italic">m : n</span> に外分する点 <span class="font-serif italic">Q(x)</span> の座標は：</p>
                <div class="text-xl text-center font-serif my-4">
                    x = 
                    <div class="math-fraction">
                        <span class="top text-red-600 font-bold">-na + mb</span>
                        <span class="bottom font-bold">m - n</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. インタラクティブ・シミュレーター -->
        <section class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold text-indigo-700 border-b-2 border-indigo-200 pb-2 mb-4">2. 実験してみよう（シミュレーター）</h2>
            <p class="text-sm text-gray-600 mb-4">スライダーを動かして、点Qがどう動くか観察してみましょう。</p>

            <!-- Sliders Container -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6 border border-gray-200">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Points -->
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between mb-1">
                                <label class="text-sm font-bold text-blue-700">点Aの座標 (a)</label>
                                <span id="val-a" class="font-mono font-bold bg-white px-2 rounded border">0</span>
                            </div>
                            <input type="range" id="input-a" min="-10" max="10" step="1" value="1" class="w-full">
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <label class="text-sm font-bold text-blue-700">点Bの座標 (b)</label>
                                <span id="val-b" class="font-mono font-bold bg-white px-2 rounded border">6</span>
                            </div>
                            <input type="range" id="input-b" min="-10" max="10" step="1" value="7" class="w-full">
                        </div>
                    </div>
                    
                    <!-- Ratios -->
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between mb-1">
                                <label class="text-sm font-bold text-purple-700">比率 m</label>
                                <span id="val-m" class="font-mono font-bold bg-white px-2 rounded border">3</span>
                            </div>
                            <input type="range" id="input-m" min="1" max="10" step="1" value="3" class="w-full accent-purple-600">
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <label class="text-sm font-bold text-purple-700">比率 n</label>
                                <span id="val-n" class="font-mono font-bold bg-white px-2 rounded border">1</span>
                            </div>
                            <input type="range" id="input-n" min="1" max="10" step="1" value="1" class="w-full accent-purple-600">
                        </div>
                    </div>
                </div>
            </div>

            <div class="relative w-full h-48 border rounded bg-white overflow-hidden shadow-inner" id="canvas-container">
                <canvas id="simulationCanvas" class="w-full h-full"></canvas>
            </div>
            
            <div class="mt-4 p-3 bg-indigo-50 rounded border border-indigo-100 text-center min-h-[5rem] flex flex-col justify-center items-center transition-all duration-300">
                <p id="result-box" class="text-lg font-bold text-indigo-900 transition-opacity duration-200">
                    計算結果: Q = 
                    <span id="result-formula" class="font-mono text-base mx-2 text-gray-600"></span>
                    = <span id="result-value" class="text-3xl text-red-600 font-bold ml-2"></span>
                </p>
                <p id="error-msg" class="text-red-500 font-bold hidden bg-red-100 px-4 py-2 rounded animate-pulse">
                    ⚠ m = n のため、外分点は定義できません
                </p>
            </div>
        </section>

        <!-- 3. 練習問題 -->
        <section class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold text-green-700 border-b-2 border-green-200 pb-2 mb-4">3. 練習問題</h2>
            <p class="mb-6 text-gray-700">次の座標を求めてみましょう。</p>

            <!-- Problem 1 -->
            <div class="mb-8 border-l-4 border-green-500 pl-4 py-2 bg-green-50 rounded-r-lg">
                <h3 class="font-bold text-lg mb-2">問1 (基本)</h3>
                <p class="mb-3">2点 <span class="font-serif">A(2), B(8)</span> を <span class="font-bold">2 : 1</span> に外分する点 Q の座標を求めよ。</p>
                
                <div class="flex flex-wrap items-center gap-3 mb-3">
                    <span class="font-bold">答え:</span>
                    <input type="number" id="ans-1" placeholder="数字を入力" class="p-2 border rounded w-32 focus:ring-2 focus:ring-green-400 outline-none">
                    <button onclick="checkAnswer(1, 14)" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition shadow-sm">判定</button>
                </div>
                <div id="feedback-1" class="hidden p-3 rounded text-sm font-bold transition-all"></div>
                <button onclick="toggleHint(1)" class="text-green-600 underline text-sm mt-2 hover:text-green-800">ヒントを見る</button>
                <div id="hint-1" class="hidden mt-2 text-sm text-gray-600 bg-white p-3 rounded border shadow-sm">
                    公式：$x = \frac{-1 \times 2 + 2 \times 8}{2 - 1}$ を計算してみよう。
                </div>
            </div>

            <!-- Problem 2 -->
            <div class="mb-4 border-l-4 border-green-500 pl-4 py-2 bg-green-50 rounded-r-lg">
                <h3 class="font-bold text-lg mb-2">問2 (m < n の場合)</h3>
                <p class="mb-3">2点 <span class="font-serif">A(-1), B(5)</span> を <span class="font-bold">1 : 3</span> に外分する点 Q の座標を求めよ。</p>
                
                <div class="flex flex-wrap items-center gap-3 mb-3">
                    <span class="font-bold">答え:</span>
                    <input type="number" id="ans-2" placeholder="数字を入力" class="p-2 border rounded w-32 focus:ring-2 focus:ring-green-400 outline-none">
                    <button onclick="checkAnswer(2, -4)" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition shadow-sm">判定</button>
                </div>
                <div id="feedback-2" class="hidden p-3 rounded text-sm font-bold transition-all"></div>
                <button onclick="toggleHint(2)" class="text-green-600 underline text-sm mt-2 hover:text-green-800">ヒントを見る</button>
                <div id="hint-2" class="hidden mt-2 text-sm text-gray-600 bg-white p-3 rounded border shadow-sm">
                    分母は $1 - 3 = -2$ になります。分子は $-3 \times (-1) + 1 \times 5$ です。<br>
                    $Q$は$A$より左側になります。
                </div>
            </div>
        </section>

    </main>

    <footer class="text-center p-6 text-gray-500 text-sm">
        <p>&copy; 数学II 学習資料</p>
    </footer>

    <script>
        // --- Simulation Logic ---
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        const inputs = ['input-a', 'input-b', 'input-m', 'input-n'];

        function resizeCanvas() {
            const container = document.getElementById('canvas-container');
            // Increase resolution for cleaner text
            const dpr = window.devicePixelRatio || 1;
            canvas.width = container.clientWidth * dpr;
            canvas.height = container.clientHeight * dpr;
            ctx.scale(dpr, dpr);
            // CSS size
            canvas.style.width = container.clientWidth + 'px';
            canvas.style.height = container.clientHeight + 'px';
            
            draw();
        }

        window.addEventListener('resize', resizeCanvas);

        inputs.forEach(id => {
            const el = document.getElementById(id);
            // Update display value immediately on slide
            el.addEventListener('input', (e) => {
                const valSpan = document.getElementById(id.replace('input', 'val'));
                valSpan.textContent = e.target.value;
                draw();
            });
        });

        function draw() {
            // Get values
            const a = parseFloat(document.getElementById('input-a').value);
            const b = parseFloat(document.getElementById('input-b').value);
            const m = parseFloat(document.getElementById('input-m').value);
            const n = parseFloat(document.getElementById('input-n').value);

            const resultBox = document.getElementById('result-box');
            const resultValEl = document.getElementById('result-value');
            const resultFormEl = document.getElementById('result-formula');
            const errorMsgEl = document.getElementById('error-msg');
            
            // Canvas logical dimensions
            const width = canvas.width / (window.devicePixelRatio || 1);
            const height = canvas.height / (window.devicePixelRatio || 1);

            ctx.clearRect(0, 0, width, height);

            // Logic Check
            if (m === n) {
                resultBox.classList.add('hidden');
                errorMsgEl.classList.remove('hidden');
                return;
            } else {
                resultBox.classList.remove('hidden');
                errorMsgEl.classList.add('hidden');
            }

            // Calculation
            const q = (-n * a + m * b) / (m - n);
            
            // Display Math
            resultValEl.innerText = Math.round(q * 100) / 100;
            resultFormEl.innerText = `(${ -n }×${ a } + ${ m }×${ b }) / (${ m } - ${ n })`;


            // --- Drawing Setup ---
            // Determine Scale
            const points = [a, b, q];
            
            // Dynamic Zoom: Ensure A, B, Q are visible with some padding
            let minVal = Math.min(...points);
            let maxVal = Math.max(...points);
            let range = maxVal - minVal;
            
            // Add padding (20% of range on each side)
            if (range === 0) range = 10; // Fallback if points overlap
            const paddingVal = Math.max(2, range * 0.15); 
            minVal -= paddingVal;
            maxVal += paddingVal;
            range = maxVal - minVal;

            const drawPadding = 40;
            const drawWidth = width - (drawPadding * 2);

            function mapToX(val) {
                return drawPadding + ((val - minVal) / range) * drawWidth;
            }

            const yCenter = height / 2 + 10;

            // Draw Axis
            ctx.beginPath();
            ctx.moveTo(0, yCenter);
            ctx.lineTo(width, yCenter);
            ctx.strokeStyle = '#9ca3af'; // gray-400
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw Ticks (Smart Ticking)
            // Determine step size based on range to avoid clutter
            let step = 1;
            if (range > 20) step = 5;
            if (range > 50) step = 10;
            if (range > 100) step = 20;

            ctx.fillStyle = '#6b7280';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'center';
            
            // Align first tick
            const firstTick = Math.ceil(minVal / step) * step;

            for(let i = firstTick; i <= maxVal; i+=step) {
                const x = mapToX(i);
                ctx.beginPath();
                ctx.moveTo(x, yCenter - 5);
                ctx.lineTo(x, yCenter + 5);
                ctx.strokeStyle = '#9ca3af';
                ctx.lineWidth = 1;
                ctx.stroke();
                
                // Avoid drawing numbers colliding with main points
                const collisionThreshold = drawWidth * 0.04; // 4% of width
                const xA = mapToX(a), xB = mapToX(b), xQ = mapToX(q);
                
                if (Math.abs(x - xA) > collisionThreshold && 
                    Math.abs(x - xB) > collisionThreshold && 
                    Math.abs(x - xQ) > collisionThreshold) {
                    ctx.fillText(i, x, yCenter + 20);
                }
            }

            // Function to draw point
            function drawPoint(val, color, label, isMain = false) {
                const x = mapToX(val);
                
                // Shadow/Glow for Q
                if (isMain) {
                    ctx.beginPath();
                    ctx.arc(x, yCenter, 10, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(239, 68, 68, 0.2)'; // Red-500 transparent
                    ctx.fill();
                }

                ctx.beginPath();
                ctx.arc(x, yCenter, isMain ? 6 : 5, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                
                // Label (Top)
                ctx.font = isMain ? 'bold 16px sans-serif' : 'bold 14px sans-serif';
                ctx.fillStyle = color;
                ctx.fillText(label, x, yCenter - 20);
                
                // Value (Bottom - slightly offset to avoid axis ticks)
                ctx.font = isMain ? 'bold 14px sans-serif' : '12px sans-serif';
                ctx.fillStyle = isMain ? '#dc2626' : '#1f2937'; // Red-600 or Gray-800
                ctx.fillText(Math.round(val*100)/100, x, yCenter + 35);
            }

            // Draw Order: Non-Active first, Active last (on top)
            drawPoint(a, '#2563eb', 'A'); // Blue-600
            drawPoint(b, '#2563eb', 'B'); // Blue-600
            drawPoint(q, '#dc2626', 'Q', true); // Red-600
            
            // Draw Distance Arches (Visualizing m:n)
            drawArch(a, q, `m=${m}`, '#9333ea', -40); // Purple-600
            drawArch(q, b, `n=${n}`, '#9333ea', -25, true); 
        }

        function drawArch(startVal, endVal, labelText, color, heightOffset, isBottom = false) {
            // Ensure start is left of end for drawing logic
            let x1 = mapToX(startVal);
            let x2 = mapToX(endVal);
            
            // If points overlap perfectly, don't draw arch
            if (Math.abs(x1 - x2) < 5) return;

            const width = canvas.width / (window.devicePixelRatio || 1);
            const drawPadding = 40;
            const yCenter = (canvas.height / (window.devicePixelRatio || 1)) / 2 + 10;

            const center = (x1 + x2) / 2;
            const controlY = yCenter + heightOffset;

            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = 1.5;
            ctx.setLineDash([4, 2]);
            
            ctx.moveTo(x1, yCenter);
            ctx.quadraticCurveTo(center, controlY, x2, yCenter);
            ctx.stroke();
            ctx.setLineDash([]);

            // Label background for legibility
            ctx.font = 'bold 12px sans-serif';
            const textWidth = ctx.measureText(labelText).width;
            const labelY = yCenter + (heightOffset * 0.6); // Position label near peak

            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.fillRect(center - textWidth/2 - 2, labelY - 10, textWidth + 4, 14);

            ctx.fillStyle = color;
            ctx.fillText(labelText, center, labelY);
        }

        // Initial setup
        inputs.forEach(id => {
            document.getElementById(id.replace('input', 'val')).textContent = document.getElementById(id).value;
        });
        resizeCanvas();

        // --- Practice Problem Logic ---
        function checkAnswer(id, correctAnswer) {
            const input = document.getElementById(`ans-${id}`);
            const feedbackEl = document.getElementById(`feedback-${id}`);
            const userVal = parseFloat(input.value);

            feedbackEl.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');

            if (isNaN(userVal)) {
                feedbackEl.textContent = "数値を入力してください。";
                feedbackEl.classList.add('bg-red-100', 'text-red-700');
            } else if (Math.abs(userVal - correctAnswer) < 0.01) {
                feedbackEl.innerHTML = "✨ 正解です！素晴らしい！";
                feedbackEl.classList.add('bg-green-100', 'text-green-700');
            } else {
                feedbackEl.textContent = "不正解です。もう一度計算してみましょう。";
                feedbackEl.classList.add('bg-red-100', 'text-red-700');
            }
            feedbackEl.classList.remove('hidden');
        }

        function toggleHint(id) {
            const hint = document.getElementById(`hint-${id}`);
            hint.classList.toggle('hidden');
        }
    </script>
</body>
</html>
